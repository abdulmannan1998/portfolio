---
phase: 11-server-component-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/sections/hero-section.tsx
  - app/page.tsx
  - components/page-content.tsx
autonomous: true

must_haves:
  truths:
    - "page.tsx has no 'use client' directive and renders as a server component"
    - "page.tsx directly composes all sections (nav, hero, marquee, about, metrics, tech-and-code, experience+graph, footer) without an intermediary client wrapper"
    - "GraphSection loads via next/dynamic with ssr:false from page.tsx -- graph interactions work identically to before"
    - "Zustand store imports (graph-store) appear only inside files that have 'use client' at the top"
    - "Hero parallax scroll effect (scale + opacity reduction on scroll) functions correctly with section-aware tracking"
    - "page-content.tsx no longer exists -- it has been dissolved into page.tsx"
  artifacts:
    - path: "app/page.tsx"
      provides: "Server component page composing all sections with data"
      contains: "async function Page"
    - path: "components/sections/hero-section.tsx"
      provides: "Self-contained hero with internal scroll parallax"
      contains: "useScroll"
  key_links:
    - from: "app/page.tsx"
      to: "lib/github.ts"
      via: "server-side fetch with ISR"
      pattern: "fetchGitHubCommits"
    - from: "app/page.tsx"
      to: "components/sections/hero-section.tsx"
      via: "direct import (no props needed for scroll)"
      pattern: "HeroSection"
    - from: "app/page.tsx"
      to: "components/sections/graph-section.tsx"
      via: "next/dynamic with ssr:false"
      pattern: "dynamic.*graph-section.*ssr.*false"
    - from: "components/sections/graph-section.tsx"
      to: "lib/stores/graph-store.tsx"
      via: "Zustand hook inside use client boundary"
      pattern: "useGraphStore"
---

<objective>
Dissolve page-content.tsx into page.tsx, making page.tsx a true server component that directly composes all sections. Move the hero scroll parallax logic into HeroSection (already a "use client" boundary) so page.tsx has zero client-side hooks.

Purpose: Completes the server component migration (RSC-01). page.tsx becomes the server-side data orchestrator and layout composer, while all interactivity stays inside properly isolated "use client" boundary files. This is the prerequisite for Phase 12 (PPR with static shell + streaming).

Output: page.tsx as a server component composing all sections; HeroSection with self-contained scroll parallax; page-content.tsx deleted.
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-client-boundary-extraction/10-05-SUMMARY.md

Key context: Phase 10-05 established the data orchestration pattern where page-content.tsx imports from @/data/\* modules and passes data as props to section wrappers. This phase moves that orchestration from page-content.tsx (client) to page.tsx (server), then deletes page-content.tsx entirely.

Current page-content.tsx uses three client-side hooks (useRef, useScroll, useTransform) solely for the hero parallax effect. All other code is pure composition and data passing. Moving the parallax logic into HeroSection eliminates the need for page-content.tsx as a client wrapper.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Internalize scroll parallax in HeroSection</name>
  <files>components/sections/hero-section.tsx</files>
  <action>
Modify HeroSection to own its scroll parallax logic internally instead of receiving MotionValue props.

Current HeroSection signature:

```tsx
type HeroSectionProps = {
  heroScale: MotionValue<number>;
  heroOpacity: MotionValue<number>;
};
```

Change to:

1. Remove the `HeroSectionProps` type and the props entirely (component takes no props).
2. Inside HeroSection, add a `useRef<HTMLElement>(null)` for the section element.
3. Use `useScroll({ target: sectionRef, offset: ["start start", "end start"] })` to track scroll progress of the hero section itself. The offset config means: tracking starts when the section's top hits the viewport top, and ends when the section's bottom hits the viewport top. This produces a 0-to-1 progress as the section scrolls away.
4. Use `useTransform(scrollYProgress, [0, 1], [1, 0.8])` for heroScale and `useTransform(scrollYProgress, [0, 1], [1, 0])` for heroOpacity. The mapping range changes from [0, 0.15] to [0, 1] because previously scrollYProgress was based on the entire page container (so 15% of total page = roughly the hero section height), but now it's based on just the hero section (so 0-to-1 = the full section scroll).
5. Apply `ref={sectionRef}` to the `<motion.section>` element (it already has `style={{ scale: heroScale, opacity: heroOpacity }}`).

The result should look like:

```tsx
"use client";

import { useRef } from "react";
import { motion, useScroll, useTransform } from "framer-motion";
import { TwinklingStars } from "@/components/twinkling-stars";

export function HeroSection() {
  const sectionRef = useRef<HTMLElement>(null);
  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ["start start", "end start"],
  });
  const heroScale = useTransform(scrollYProgress, [0, 1], [1, 0.8]);
  const heroOpacity = useTransform(scrollYProgress, [0, 1], [1, 0]);

  return (
    <motion.section
      ref={sectionRef}
      style={{ scale: heroScale, opacity: heroOpacity }}
      // ... rest unchanged
    >
      {/* ... existing JSX unchanged ... */}
    </motion.section>
  );
}
```

Do NOT change any of the existing JSX, class names, animations, or structure. Only change the props interface and add the internal scroll logic.
</action>
<verify>Run `npx tsc --noEmit 2>&1 | head -20` to verify HeroSection compiles without type errors. Note: page-content.tsx will show errors because it still passes the old props -- that's expected and fixed in Task 2.</verify>
<done>HeroSection has internal useScroll/useTransform, takes no props, and compiles cleanly in isolation.</done>
</task>

<task type="auto">
  <name>Task 2: Dissolve page-content.tsx into server component page.tsx</name>
  <files>app/page.tsx, components/page-content.tsx</files>
  <action>
Replace the current page.tsx (8 lines) with the full page composition that currently lives in page-content.tsx, adapted for server component context. Then delete page-content.tsx.

1. **Rewrite app/page.tsx** with the following structure:

```tsx
import dynamic from "next/dynamic";
import Link from "next/link";
import { Github, Linkedin, Mail, Beaker } from "lucide-react";
import { MarqueeText } from "@/components/marquee-text";
import { ExperienceTimeline } from "@/components/sections/experience-timeline";
import { MetricsSection } from "@/components/sections/metrics-section";
import { TechAndCodeSection } from "@/components/sections/tech-and-code-section";
import { HeroSection } from "@/components/sections/hero-section";
import { AboutSection } from "@/components/sections/about-section";
import { SOCIAL_LINKS } from "@/lib/social-links";
import { mulberry32 } from "@/lib/seeded-random";
import { RESUME_DATA } from "@/data/resume-data";
import { experienceData } from "@/data/experience";
import { techCategories } from "@/data/tech-stack";
import { fetchGitHubCommits } from "@/lib/github";

// Lazy load React Flow graph (client-only, ssr:false)
const GraphSection = dynamic(
  () =>
    import("@/components/sections/graph-section").then(
      (mod) => mod.GraphSection,
    ),
  {
    ssr: false,
    loading: () => (
      <section className="py-24 px-6 md:px-12">
        <div className="max-w-7xl mx-auto">
          <div className="h-[600px] bg-stone-900 animate-pulse flex items-center justify-center">
            <span className="text-white/40 font-mono text-sm uppercase">
              Loading graph...
            </span>
          </div>
        </div>
      </section>
    ),
  },
);

// Generate deterministic positions for background pattern (seeded PRNG)
const bgRandom = mulberry32(137);
const backgroundPattern = [...Array(20)].map(() => ({
  top: bgRandom() * 100,
  left: bgRandom() * 100,
  rotate: bgRandom() * 360,
}));

export default async function Page() {
  const commits = await fetchGitHubCommits();

  return (
    <main className="relative min-h-screen bg-black text-white font-sans overflow-x-hidden">
      {/* Fixed navigation */}
      <nav className="fixed top-0 left-0 right-0 z-50 mix-blend-difference">
        {/* ... copy nav JSX from page-content.tsx exactly ... */}
      </nav>

      <HeroSection />

      {/* Scrolling marquee section */}
      <section className="relative bg-orange-500 py-8 -rotate-1">
        <div className="text-6xl md:text-8xl font-black text-black uppercase">
          <MarqueeText text="REACT * TYPESCRIPT * NEXT.JS * DATA VIZ * AI TOOLS *" />
        </div>
      </section>

      <AboutSection backgroundPattern={backgroundPattern} />

      {/* Impact metrics */}
      <MetricsSection metrics={RESUME_DATA.metrics} />

      {/* Tech stack + GitHub activity combined */}
      <TechAndCodeSection categories={techCategories} commits={commits} />

      {/* Experience + Career Graph side by side */}
      <section className="relative py-24 bg-stone-950">
        <div className="max-w-[1800px] mx-auto px-6 md:px-12 lg:px-16">
          <div className="grid grid-cols-1 lg:grid-cols-[minmax(300px,400px)_1fr] gap-12 lg:gap-16">
            <ExperienceTimeline experiences={experienceData} />
            <GraphSection />
          </div>
        </div>
      </section>

      {/* CTA / Footer */}
      <section className="relative py-24 bg-orange-500">
        {/* ... copy footer JSX from page-content.tsx exactly ... */}
      </section>

      {/* Bottom marquee */}
      <section className="bg-black py-6 border-t border-white/10">
        <div className="text-4xl font-black text-white/20 uppercase">
          <MarqueeText
            text="MANNAN ABDUL * SENIOR SOFTWARE ENGINEER * LAHORE, PAKISTAN *"
            direction={-1}
          />
        </div>
      </section>
    </main>
  );
}
```

Key differences from page-content.tsx:

- NO "use client" directive
- NO useRef, useScroll, useTransform imports (parallax is now inside HeroSection)
- NO containerRef on `<main>` (no longer needed)
- `<HeroSection />` takes no props (it manages its own scroll internally)
- The function is `async` (server component, fetches GitHub data)
- All data imports are now server-side (RESUME_DATA, experienceData, techCategories)
- dynamic() import of GraphSection runs in server context (loading fallback renders on server)
- backgroundPattern generation runs on server (module-level, deterministic)

IMPORTANT: Copy the nav and footer JSX EXACTLY from page-content.tsx. Do not modify any class names, structure, or content. The only JSX change is removing `ref={containerRef}` from `<main>` and removing props from `<HeroSection />`.

2. **Delete components/page-content.tsx** entirely (use `rm` or equivalent).

3. **Verify no remaining imports of page-content.tsx exist** anywhere in the codebase.
   </action>
   <verify>
   Run these checks in sequence:
4. `npx tsc --noEmit` -- zero type errors
5. `npm run build` -- successful production build
6. `grep -r "page-content" app/ components/ --include="*.tsx" --include="*.ts"` -- zero results (no remaining references)
7. `grep -r "use client" app/page.tsx` -- zero results (page.tsx is a server component)
8. `grep -rn "graph-store" components/ lib/ --include="*.tsx" --include="*.ts"` -- only appears in files that have "use client" at top (graph-section.tsx, achievement-node.tsx, graph-store.tsx itself)
   </verify>
   <done>
   page.tsx is a server component directly composing all sections. page-content.tsx is deleted. GraphSection loads via dynamic import with ssr:false from the server component. Zustand store imports remain confined to "use client" files. Build passes cleanly.
   </done>
   </task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` succeeds with zero errors
2. `grep '"use client"' app/page.tsx` returns nothing (page.tsx is a server component)
3. `grep -r 'page-content' app/ components/ lib/` returns nothing (page-content.tsx fully dissolved)
4. `grep -rn 'graph-store' components/ lib/ --include='*.tsx'` shows imports only in graph-section.tsx and achievement-node.tsx (both "use client")
5. Dev server (`npm run dev`) renders the page correctly with all sections visible
6. Hero parallax effect works (hero scales and fades as user scrolls down)
7. Graph section loads lazily and interactions (hover reveal, node expansion) work normally
</verification>

<success_criteria>

1. page.tsx has no "use client" directive and renders on the server (async function with server-side data fetch)
2. GraphSection loads via dynamic import with ssr:false from page.tsx (server component) -- graph interactions work identically to before
3. Zustand store imports (graph-store) appear only inside files that have "use client" at the top
4. page-content.tsx no longer exists in the codebase
5. Hero parallax scroll effect works identically (scale + opacity reduction on scroll)
6. All sections render correctly with no visual regression
   </success_criteria>

<output>
After completion, create `.planning/phases/11-server-component-page/11-01-SUMMARY.md`
</output>
