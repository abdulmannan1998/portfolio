---
phase: 02-constants-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/layout-constants.ts
  - lib/layout-calculator.ts
  - components/dashboard-background.tsx
autonomous: true

must_haves:
  truths:
    - "Layout calculations reference named constants instead of inline numbers"
    - "Safe area dimensions have single source of truth in layout-constants.ts"
    - "Achievement positioning values are configurable via constants"
    - "Reveal timing values are defined in configuration, not component logic"
  artifacts:
    - path: "lib/layout-constants.ts"
      provides: "Centralized constants for layout, positioning, timing"
      exports: ["SAFE_AREA", "ACHIEVEMENT_LAYOUT", "REVEAL_TIMING"]
      contains: "as const"
    - path: "lib/layout-calculator.ts"
      provides: "Layout calculations using named constants"
      contains: "import { SAFE_AREA, ACHIEVEMENT_LAYOUT } from"
    - path: "components/dashboard-background.tsx"
      provides: "Reveal sequence using timing constants"
      contains: "import { REVEAL_TIMING } from"
  key_links:
    - from: "lib/layout-calculator.ts"
      to: "lib/layout-constants.ts"
      via: "named import"
      pattern: "SAFE_AREA\\.HEADER_HEIGHT"
    - from: "lib/layout-calculator.ts"
      to: "lib/layout-constants.ts"
      via: "named import"
      pattern: "ACHIEVEMENT_LAYOUT\\.VERTICAL_SPACING"
    - from: "components/dashboard-background.tsx"
      to: "lib/layout-constants.ts"
      via: "named import"
      pattern: "REVEAL_TIMING\\.(EDUCATION|LAYERMARK|INTENSEYE)_DELAY_MS"
---

<objective>
Extract all magic numbers from layout calculations and timing sequences into centralized named constants.

Purpose: Establish single source of truth for layout dimensions and timing values, making the codebase more maintainable and values more discoverable.

Output: New lib/layout-constants.ts with SAFE_AREA, ACHIEVEMENT_LAYOUT, and REVEAL_TIMING constant objects; updated layout-calculator.ts and dashboard-background.tsx importing and using these constants.
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-constants-extraction/02-RESEARCH.md

@lib/layout-calculator.ts
@components/dashboard-background.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create centralized constants file</name>
  <files>lib/layout-constants.ts</files>
  <action>
Create lib/layout-constants.ts with three domain-grouped constant objects:

1. SAFE_AREA - viewport space reserved for UI elements:
   - HEADER_HEIGHT: 140 (top header space in px)
   - METRICS_HEIGHT: 220 (bottom metrics panel in px)
   - LEFT_MARGIN: 240 (left sidebar/margin in px - per CONST-01 requirement)
   - RIGHT_MARGIN: 100 (right margin in px)

2. ACHIEVEMENT_LAYOUT - achievement node positioning:
   - VERTICAL_SPACING: 200 (space between achievement nodes in px)
   - INITIAL_OFFSET_Y: 250 (distance below parent company node in px)
   - HORIZONTAL_STAGGER: 150 (zigzag offset for visual interest in px)

3. REVEAL_TIMING - animation timing sequence:
   - EDUCATION_DELAY_MS: 1200 (when Bilkent appears)
   - LAYERMARK_DELAY_MS: 1700 (when Layermark appears)
   - INTENSEYE_DELAY_MS: 2200 (when Intenseye appears)

Use UPPER_SNAKE_CASE naming, `as const` assertions for type safety, named exports, and JSDoc comments explaining each constant group's purpose.
</action>
<verify>
File exists at lib/layout-constants.ts and exports SAFE_AREA, ACHIEVEMENT_LAYOUT, REVEAL_TIMING with correct values. Run: `grep -E "(SAFE_AREA|ACHIEVEMENT_LAYOUT|REVEAL_TIMING)" lib/layout-constants.ts`
</verify>
<done>
lib/layout-constants.ts exists with all three constant objects exported, each using `as const` assertion and containing the specified values.
</done>
</task>

<task type="auto">
  <name>Task 2: Update layout-calculator.ts to use constants</name>
  <files>lib/layout-calculator.ts</files>
  <action>
Update lib/layout-calculator.ts to import and use constants from layout-constants.ts:

1. Add import at top: `import { SAFE_AREA, ACHIEVEMENT_LAYOUT } from "./layout-constants";`

2. Update calculateSafeArea function default parameters (lines 28-33):
   - headerHeight = SAFE_AREA.HEADER_HEIGHT
   - metricsHeight = SAFE_AREA.METRICS_HEIGHT
   - leftMargin = SAFE_AREA.LEFT_MARGIN
   - rightMargin = SAFE_AREA.RIGHT_MARGIN

3. Update achievement layout variables (lines 212-214):
   - Replace `const achievementSpacing = 200;` with `const achievementSpacing = ACHIEVEMENT_LAYOUT.VERTICAL_SPACING;`
   - Replace `const achievementOffsetY = 250;` with `const achievementOffsetY = ACHIEVEMENT_LAYOUT.INITIAL_OFFSET_Y;`
   - Replace `const staggerX = 150;` with `const staggerX = ACHIEVEMENT_LAYOUT.HORIZONTAL_STAGGER;`

Note: The current code has leftMargin = 100, but CONST-01 requirement specifies 240. Use 240 per requirement.
</action>
<verify>
Run: `npm run build` (or `npx tsc --noEmit`) - no TypeScript errors. Verify constants are used: `grep -E "(SAFE_AREA|ACHIEVEMENT_LAYOUT)" lib/layout-calculator.ts`
</verify>
<done>
layout-calculator.ts imports from layout-constants.ts and all magic numbers for safe area and achievement positioning are replaced with constant references. No inline numeric literals for these values remain.
</done>
</task>

<task type="auto">
  <name>Task 3: Update dashboard-background.tsx to use timing constants</name>
  <files>components/dashboard-background.tsx</files>
  <action>
Update components/dashboard-background.tsx to import and use timing constants:

1. Add import near top (after existing imports): `import { REVEAL_TIMING } from "@/lib/layout-constants";`

2. Update startRevealSequence function setTimeout calls:
   - Replace `}, 1200);` (Stage 2: Education) with `}, REVEAL_TIMING.EDUCATION_DELAY_MS);`
   - Replace `}, 1700);` (Stage 3: Layermark) with `}, REVEAL_TIMING.LAYERMARK_DELAY_MS);`
   - Replace `}, 2200);` (Stage 4: Intenseye) with `}, REVEAL_TIMING.INTENSEYE_DELAY_MS);`

The setTimeout calls are in the startRevealSequence callback around lines 191-206.
</action>
<verify>
Run: `npm run build` (or `npx tsc --noEmit`) - no TypeScript errors. Verify constants are used: `grep -E "REVEAL_TIMING" components/dashboard-background.tsx`
</verify>
<done>
dashboard-background.tsx imports REVEAL_TIMING and all three setTimeout calls use named timing constants instead of magic numbers.
</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compilation:** `npm run build` passes with no errors
2. **Constants file exists:** `ls lib/layout-constants.ts` shows file exists
3. **No remaining magic numbers:**
   - `grep -E "= (140|220|240|100)" lib/layout-calculator.ts` returns empty (no inline defaults)
   - `grep -E "= (200|250|150)" lib/layout-calculator.ts` returns empty (no inline achievement values)
   - `grep -E ", (1200|1700|2200)\)" components/dashboard-background.tsx` returns empty (no inline timing)
4. **Constants are imported:**
   - `grep "layout-constants" lib/layout-calculator.ts` shows import
   - `grep "layout-constants" components/dashboard-background.tsx` shows import
     </verification>

<success_criteria>
Phase 02 is complete when:

- lib/layout-constants.ts exists with SAFE_AREA, ACHIEVEMENT_LAYOUT, REVEAL_TIMING exports
- layout-calculator.ts imports and uses SAFE_AREA and ACHIEVEMENT_LAYOUT constants
- dashboard-background.tsx imports and uses REVEAL_TIMING constants
- All magic numbers specified in requirements (140, 220, 240, 200, 250, 150, 1200, 1700, 2200) are replaced
- TypeScript compilation succeeds
- Visual regression testing passes (graph still displays correctly)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-constants-extraction/02-01-SUMMARY.md`
</output>
