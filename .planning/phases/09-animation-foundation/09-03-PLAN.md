---
phase: 09-animation-foundation
plan: 03
type: execute
wave: 1
depends_on: ["09-02"]
files_modified: ["components/hero-parallax.tsx"]
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Hero parallax fades and scales gradually over the first ~15% of total page scroll distance, not 15% of viewport height"
    - "User can scroll past the marquee text before the hero fully disappears"
    - "Parallax effect feels identical to the original framer-motion implementation"
  artifacts:
    - path: "components/hero-parallax.tsx"
      provides: "Corrected maxScroll calculation using document scroll height"
      contains: "document.documentElement.scrollHeight"
  key_links:
    - from: "components/hero-parallax.tsx"
      to: "window scroll position"
      via: "scrollY / maxScroll ratio"
      pattern: "documentElement\\.scrollHeight.*innerHeight.*0\\.15"
---

<objective>
Fix hero parallax fade speed so the hero fades and scales over the first 15% of TOTAL scrollable distance (matching framer-motion scrollYProgress behavior), not 15% of viewport height.

Purpose: UAT revealed the hero disappears ~4.5x faster than the original framer-motion implementation. The original used scrollYProgress with range [0, 0.15], which means 15% of total scroll distance. The replacement incorrectly used window.innerHeight \* 0.15 (viewport-relative), causing the hero to vanish before the marquee text is even visible.

Output: Corrected hero-parallax.tsx with proper scroll distance calculation.
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-animation-foundation/09-UAT.md
@.planning/phases/09-animation-foundation/09-02-SUMMARY.md
@components/hero-parallax.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix maxScroll calculation to use total scroll distance</name>
  <files>components/hero-parallax.tsx</files>
  <action>
    On line 20 of components/hero-parallax.tsx, change:

    ```
    const maxScroll = window.innerHeight * 0.15;
    ```

    to:

    ```
    const maxScroll = (document.documentElement.scrollHeight - window.innerHeight) * 0.15;
    ```

    This matches framer-motion's scrollYProgress behavior where [0, 0.15] represents 15% of total scrollable distance (scrollHeight minus viewport height), not 15% of viewport height.

    On a page with scrollHeight ~5000px and viewport 900px, this changes maxScroll from ~135px to ~615px -- matching the original gradual fade.

    Do NOT change anything else in the file. The scale formula (1 - progress * 0.2), opacity formula (1 - progress), requestAnimationFrame throttling, passive listener, and initial updateParallax() call are all correct.

  </action>
  <verify>
    1. Run `npx next build` -- build succeeds with no errors
    2. Run `npx next dev` and open http://localhost:3000
    3. Open browser console, run: `document.documentElement.scrollHeight` and `window.innerHeight` to confirm scroll height is much larger than viewport
    4. Scroll down slowly -- hero should fade and scale gradually, remaining visible well past the marquee text area
  </verify>
  <done>
    Line 20 reads `const maxScroll = (document.documentElement.scrollHeight - window.innerHeight) * 0.15;` and build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed hero parallax fade speed to match original framer-motion behavior. The hero now fades over 15% of total scroll distance instead of 15% of viewport height.</what-built>
  <how-to-verify>
    1. Open http://localhost:3000 (dev server should be running)
    2. Start at the top of the page
    3. Scroll down slowly through the hero section
    4. Verify the hero fades and scales GRADUALLY -- it should still be partially visible as you scroll past the marquee text
    5. Compare to your memory of the original behavior -- the fade should feel the same as before the migration
    6. Scroll back to top -- hero should be fully visible (opacity 1, scale 1)
  </how-to-verify>
  <resume-signal>Type "approved" if the fade timing matches the original, or describe what still feels off</resume-signal>
</task>

</tasks>

<verification>
- `npx next build` passes with no errors
- Hero parallax fade is gradual over ~15% of total page scroll
- No visual regression in other sections
</verification>

<success_criteria>
Hero parallax scroll effect matches original framer-motion behavior: gradual fade and scale over the first ~15% of total page scroll distance. User can scroll past the marquee text before the hero fully disappears.
</success_criteria>

<output>
After completion, create `.planning/phases/09-animation-foundation/09-03-SUMMARY.md`
</output>
