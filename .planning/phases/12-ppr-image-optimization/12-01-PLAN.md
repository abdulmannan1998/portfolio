---
phase: 12-ppr-image-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/github-activity-stream.tsx
  - components/github-activity-error.tsx
  - components/github-activity-skeleton.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "GitHub activity section streams in via Suspense with a visible skeleton fallback during loading"
    - "Hero, about, metrics, and timeline sections render as static HTML in the initial response (visible in view-source before JS loads)"
    - "If GitHub API fails, a meaningful error fallback renders instead of a broken page"
  artifacts:
    - path: "components/github-activity-skeleton.tsx"
      provides: "Skeleton fallback matching GitHubActivity layout dimensions"
    - path: "components/github-activity-error.tsx"
      provides: "ErrorBoundary component with meaningful fallback UI for GitHub section"
    - path: "components/github-activity-stream.tsx"
      provides: "Async server component that fetches GitHub data and renders GitHubActivity"
    - path: "app/page.tsx"
      provides: "Suspense boundary wrapping GitHub activity with skeleton fallback, ErrorBoundary wrapping Suspense"
  key_links:
    - from: "app/page.tsx"
      to: "components/github-activity-stream.tsx"
      via: "Suspense boundary with skeleton fallback"
      pattern: "<Suspense.*fallback.*GitHubActivitySkeleton"
    - from: "app/page.tsx"
      to: "components/github-activity-error.tsx"
      via: "ErrorBoundary wrapping Suspense"
      pattern: "<GitHubActivityError.*<Suspense"
    - from: "components/github-activity-stream.tsx"
      to: "lib/github.ts"
      via: "Server-side fetch with ISR"
      pattern: "fetchGitHubCommits"
---

<objective>
Add Suspense streaming and error handling to the GitHub activity section so PPR serves a static shell instantly while dynamic GitHub data streams in.

Purpose: With cacheComponents already enabled, adding a Suspense boundary around the GitHub fetch creates the PPR split point -- everything outside Suspense is the static shell (hero, about, metrics, timeline), everything inside streams dynamically. The ErrorBoundary ensures graceful degradation if the GitHub API fails.

Output: GitHub activity streams in via Suspense with skeleton fallback, paired with ErrorBoundary for failure resilience. Static sections render as prerendered HTML.
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-server-component-page/11-01-SUMMARY.md

@app/page.tsx
@lib/github.ts
@components/github-activity.tsx
@components/sections/tech-and-code-section.tsx
@next.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skeleton, error boundary, and async stream components</name>
  <files>
    components/github-activity-skeleton.tsx
    components/github-activity-error.tsx
    components/github-activity-stream.tsx
  </files>
  <action>
    Create three new components:

    1. **components/github-activity-skeleton.tsx** (server component, no "use client"):
       - Render a skeleton that matches the GitHubActivity component layout (same container bg-stone-900 p-6, orange corner accent, header with GitHub icon placeholder, 3 commit placeholder rows with shimmer)
       - Use Tailwind animate-pulse on placeholder blocks
       - Match the exact structure: corner accent div, header area (icon + text), 3 commit-shaped placeholder rows (varying widths for visual interest: first row wider, second medium, third shorter)
       - Export as `GitHubActivitySkeleton`

    2. **components/github-activity-error.tsx** ("use client" -- ErrorBoundary requires client component):
       - Create a React error boundary class component named `GitHubActivityError`
       - Props: `children: React.ReactNode`
       - State: `{ hasError: boolean }`
       - `static getDerivedStateFromError()` returns `{ hasError: true }`
       - `componentDidCatch(error, errorInfo)` logs to console.error
       - Fallback UI: Same bg-stone-900 p-6 container as GitHubActivity, shows "Unable to load GitHub activity" message with a muted style (text-white/40 font-mono), and a "Retry" button that calls `this.setState({ hasError: false })` to attempt re-render
       - When no error, render `this.props.children`

    3. **components/github-activity-stream.tsx** (async server component, no "use client"):
       - Import `fetchGitHubCommits` from `@/lib/github`
       - Import `GitHubActivity` from `@/components/github-activity`
       - Import `SOCIAL_LINKS` from `@/lib/social-links`
       - Export async function `GitHubActivityStream` that:
         - Calls `const commits = await fetchGitHubCommits()`
         - Returns `<GitHubActivity commits={commits} username={SOCIAL_LINKS.github.username} />`
       - This extracts the async data fetching from page.tsx into a dedicated component that Suspense can wrap

  </action>
  <verify>
    Run `npx tsc --noEmit` -- zero type errors for all three new files.
  </verify>
  <done>
    Three components exist: skeleton matches GitHubActivity layout, error boundary catches and displays fallback, stream component fetches data server-side.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Suspense and ErrorBoundary into page.tsx</name>
  <files>
    app/page.tsx
  </files>
  <action>
    Modify page.tsx to use the new components:

    1. **Add imports** at top of page.tsx:
       - `import { Suspense } from "react"`
       - `import { GitHubActivityStream } from "@/components/github-activity-stream"`
       - `import { GitHubActivityError } from "@/components/github-activity-error"`
       - `import { GitHubActivitySkeleton } from "@/components/github-activity-skeleton"`

    2. **Remove the direct GitHub fetch** from the Page function:
       - Remove `const commits = await fetchGitHubCommits()` from the function body
       - Remove the `fetchGitHubCommits` import
       - Remove the `SOCIAL_LINKS` import (only if it's no longer used elsewhere in page.tsx -- check nav links first; they use SOCIAL_LINKS so keep the import)

    3. **Update TechAndCodeSection rendering:**
       The current TechAndCodeSection receives `commits` as a prop and renders GitHubActivity internally. This couples the static tech stack with the dynamic GitHub data, preventing the PPR split.

       Restructure the "Tech stack + GitHub activity combined" section in page.tsx:
       - Replace the single `<TechAndCodeSection categories={techCategories} commits={commits} />` with a layout that separates static and dynamic content:

       ```tsx
       {/* Tech stack + GitHub activity combined */}
       <section className="relative py-24 bg-black overflow-hidden">
         <div className="px-6 md:px-12 mb-16">
           <span className="text-orange-500 font-mono text-sm uppercase tracking-widest">
             Technologies
           </span>
           <h2 className="text-5xl md:text-6xl font-black mt-2">STACK & CODE</h2>
         </div>
         <div className="px-6 md:px-12">
           <div className="relative grid grid-cols-1 lg:grid-cols-2">
             {/* Diagonal orange stripe at junction */}
             <div className="hidden lg:block absolute left-1/2 top-0 bottom-0 -translate-x-1/2 w-10 z-10 overflow-hidden pointer-events-none">
               <div
                 className="absolute inset-0 bg-orange-500"
                 style={{ clipPath: "polygon(35% 0%, 65% 0%, 50% 100%, 20% 100%)" }}
               />
             </div>

             {/* LEFT: Tech Stack (static, part of PPR shell) */}
             <TechStackSection categories={techCategories} />

             {/* Mobile orange divider */}
             <div className="lg:hidden h-1 bg-orange-500 my-10" />

             {/* RIGHT: GitHub Activity (dynamic, streams via Suspense) */}
             <div className="lg:pl-14">
               <div className="mb-8">
                 <div className="flex items-baseline gap-3 mb-2">
                   <span className="text-4xl md:text-5xl font-black text-white/15 uppercase leading-none">LIVE</span>
                   <div className="w-2 h-2 bg-orange-500 animate-pulse" />
                 </div>
                 <div className="h-px bg-white/20" />
               </div>
               <GitHubActivityError>
                 <Suspense fallback={<GitHubActivitySkeleton />}>
                   <GitHubActivityStream />
                 </Suspense>
               </GitHubActivityError>
               <div className="mt-10 pt-6 border-t border-white/10">
                 <div className="grid grid-cols-2 gap-4">
                   <div>
                     <span className="text-white/35 font-mono text-[9px] uppercase tracking-widest block mb-1">Source</span>
                     <span className="text-white/55 font-mono text-xs">GitHub API</span>
                   </div>
                   <div>
                     <span className="text-white/35 font-mono text-[9px] uppercase tracking-widest block mb-1">Refresh</span>
                     <span className="text-white/55 font-mono text-xs">5 min cache</span>
                   </div>
                 </div>
               </div>
             </div>
           </div>
         </div>
       </section>
       ```

    4. **Refactor TechAndCodeSection to TechStackSection:**
       - Rename `TechAndCodeSection` to `TechStackSection` (or create new component)
       - Remove the `commits` prop and all GitHub-related rendering from it
       - Keep only the tech stack grid (LEFT side content: categories with icons)
       - Update the component to render just `<div className="lg:pr-14 space-y-8">` with the category mapping inside
       - Update the import in page.tsx accordingly
       - The component stays "use client" because it uses framer-motion for entrance animations

    5. **Remove stale imports** from page.tsx:
       - Remove `fetchGitHubCommits` import (data fetching moved to GitHubActivityStream)
       - Remove `GitHubActivity` direct import if present
       - Keep `SOCIAL_LINKS` since nav links use it

    6. **Make Page function synchronous** if possible:
       - Since `fetchGitHubCommits()` moves to GitHubActivityStream, the Page function no longer needs `await`
       - Change `export default async function Page()` to `export default function Page()`
       - This makes the entire page shell fully static (prerendered), with only the Suspense hole being dynamic

    **Important:** The `fetchGitHubCommits` import and `SOCIAL_LINKS.github.username` usage move from page.tsx to github-activity-stream.tsx. The page.tsx only imports the stream wrapper, not the data fetching logic.

  </action>
  <verify>
    Run `npm run build` -- build succeeds with zero errors. Check build output for PPR indicators (static shell + dynamic hole). The build output should show the page as partially prerendered.
  </verify>
  <done>
    page.tsx wraps GitHub section in ErrorBoundary > Suspense > GitHubActivityStream. Static sections (hero, about, metrics, timeline, tech stack) are outside any Suspense boundary. TechAndCodeSection is split: tech stack is static, GitHub streams dynamically. Build passes cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Build output shows PPR behavior (static shell + dynamic streaming hole)
3. `npx tsc --noEmit` passes with zero type errors
4. Grep confirms: `Suspense` wraps `GitHubActivityStream` in page.tsx
5. Grep confirms: `GitHubActivityError` wraps `Suspense` in page.tsx
6. Grep confirms: `fetchGitHubCommits` is NOT imported in page.tsx (moved to stream component)
7. Grep confirms: No `commits` prop passed to TechStackSection
</verification>

<success_criteria>

- GitHub activity section is wrapped in ErrorBoundary > Suspense > async component
- Skeleton fallback renders during GitHub data streaming
- Error boundary catches failures and shows meaningful fallback with retry
- Hero, about, metrics, timeline, and tech stack sections are OUTSIDE Suspense (part of static shell)
- Build succeeds with PPR behavior confirmed
- Page function is no longer async (fully static shell)
  </success_criteria>

<output>
After completion, create `.planning/phases/12-ppr-image-optimization/12-01-SUMMARY.md`
</output>
