---
phase: 05-performance-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/custom-node.tsx
  - components/nodes/achievement-node.tsx
  - components/dashboard-background.tsx
autonomous: true

must_haves:
  truths:
    - "Animation variants are defined once at module load, not recreated per render"
    - "Position calculations are skipped when viewport dimensions haven't changed"
  artifacts:
    - path: "components/custom-node.tsx"
      provides: "Module-level animation variants"
      contains: "const.*VARIANTS.*Variants"
    - path: "components/nodes/achievement-node.tsx"
      provides: "Module-level entrance animation variants"
      contains: "const.*ENTRANCE_VARIANTS"
    - path: "components/dashboard-background.tsx"
      provides: "Memoized getInitialNodes call"
      contains: "useMemo.*getInitialNodes"
  key_links:
    - from: "components/custom-node.tsx"
      to: "framer-motion Variants"
      via: "module-level constant references"
      pattern: "variants.*VARIANTS"
---

<objective>
Extract animation variants to module-level constants and add memoization to position calculations.

Purpose: Eliminate per-render object recreation for animation variants and prevent redundant layout calculations when viewport dimensions haven't changed.

Output: Animation variants defined once at module load in custom-node.tsx and achievement-node.tsx; memoized getInitialNodes in dashboard-background.tsx.
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-performance-optimization/05-RESEARCH.md

@components/custom-node.tsx
@components/nodes/achievement-node.tsx
@components/dashboard-background.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract animation variants to module-level constants in custom-node.tsx</name>
  <files>components/custom-node.tsx</files>
  <action>
Extract the `getEntranceAnimation` function (lines 12-54) into module-level constant objects.

Create these module-level constants with `Variants` type from framer-motion:

- HERO_ENTRANCE_VARIANTS (initial/animate for hero-entrance)
- BLOOM_IN_VARIANTS (initial/animate for bloom-in)
- SLIDE_UP_VARIANTS (initial/animate for slide-up)
- FADE_DROP_VARIANTS (initial/animate for fade-drop)
- POP_IN_VARIANTS (initial/animate for pop-in)
- DEFAULT_VARIANTS (initial/animate for default case)

Create module-level transition constants:

- HERO_ENTRANCE_TRANSITION
- BLOOM_TRANSITION
- SLIDE_UP_TRANSITION
- FADE_DROP_TRANSITION
- POP_IN_TRANSITION
- DEFAULT_TRANSITION

Replace `getEntranceAnimation` with `getAnimationConfig` that returns references to these constants (not new objects).

Update component usage to use getAnimationConfig and spread the transition with delay.

Keep the existing softSkillDuration module-level constant.
</action>
<verify>
Run `npx tsc --noEmit` - no TypeScript errors.
Visual: Animation variants are defined BEFORE any function/component code.
</verify>
<done>
Animation variants are module-level constants in custom-node.tsx, not recreated per render.
</done>
</task>

<task type="auto">
  <name>Task 2: Extract animation variants to module-level in achievement-node.tsx</name>
  <files>components/nodes/achievement-node.tsx</files>
  <action>
Extract the inline variants object (lines 66-68) to module-level constant.

Create module-level constant:

```typescript
const EXPAND_COLLAPSE_VARIANTS: Variants = {
  collapsed: { width: 250, height: 80 },
  expanded: { width: 400, height: "auto", minHeight: 300 },
};
```

Also extract the entrance animation (currently inline at lines 58-59) to module constant:

```typescript
const ENTRANCE_VARIANTS: Variants = {
  initial: { opacity: 0, scale: 0.9 },
  animate: { opacity: 1, scale: 1 },
};
```

Update the motion.div to reference these constants instead of inline objects.

Import `Variants` type from framer-motion.
</action>
<verify>
Run `npx tsc --noEmit` - no TypeScript errors.
Visual: Animation variants are defined at module level before component.
</verify>
<done>
Animation variants are module-level constants in achievement-node.tsx.
</done>
</task>

<task type="auto">
  <name>Task 3: Add useMemo for getInitialNodes position calculations</name>
  <files>components/dashboard-background.tsx</files>
  <action>
Add memoization to prevent redundant getInitialNodes calculations.

1. Add `useMemo` to imports from react.

2. Create memoized allNodes computation:

```typescript
const allNodes = useMemo(() => {
  return getInitialNodes(graphDimensions);
}, [graphDimensions.width, graphDimensions.height]);
```

3. Create memoized allEdges computation (edges don't depend on dimensions):

```typescript
const allEdges = useMemo(() => {
  return getInitialEdges();
}, []);
```

4. Update the useEffect that populates refs (line 55-59) to sync from memoized values:

```typescript
useEffect(() => {
  allNodesRef.current = allNodes;
  allEdgesRef.current = allEdges;
}, [allNodes, allEdges]);
```

5. Remove duplicate getInitialNodes call from dimension change effect (line 254) - the memoized value already updates when dimensions change.

IMPORTANT: Use primitive dependencies [graphDimensions.width, graphDimensions.height] not object [graphDimensions] to avoid false recalculations.
</action>
<verify>
Run `npx tsc --noEmit` - no TypeScript errors.
Run `npm run build` - build succeeds.
</verify>
<done>
Position calculations use useMemo with primitive dependencies, preventing redundant recalculation when dimensions unchanged.
</done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npx tsc --noEmit`
2. Build succeeds: `npm run build`
3. Code review: Animation variants defined at module level (before component functions)
4. Code review: No `getEntranceAnimation` calls creating new objects per render
5. Code review: useMemo wraps getInitialNodes with primitive dependencies
</verification>

<success_criteria>

- PERF-03 complete: Animation variants are module-level constants in both custom-node.tsx and achievement-node.tsx
- PERF-04 complete: getInitialNodes wrapped in useMemo with [graphDimensions.width, graphDimensions.height] dependencies
- No TypeScript errors
- Build succeeds
  </success_criteria>

<output>
After completion, create `.planning/phases/05-performance-optimization/05-01-SUMMARY.md`
</output>
