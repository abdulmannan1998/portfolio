---
phase: 08-technical-debt
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/github-activity.tsx
autonomous: true

must_haves:
  truths:
    - "GitHub API response is cached in memory with 5-minute TTL"
    - "Second component mount within TTL uses cached data without API call"
    - "Cache miss triggers fresh API fetch"
  artifacts:
    - path: "components/github-activity.tsx"
      provides: "GitHub activity with caching"
      contains: "CACHE_TTL"
  key_links:
    - from: "components/github-activity.tsx"
      to: "memory cache"
      via: "eventCache Map"
      pattern: "eventCache\\.(get|set)"
---

<objective>
Add memory caching to GitHub API calls to prevent redundant fetches

Purpose: Prevent rate limit issues and improve performance by caching GitHub events for 5 minutes
Output: github-activity.tsx with in-memory cache for API responses
</objective>

<execution_context>
@/Users/sunny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sunny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-technical-debt/08-RESEARCH.md

@components/github-activity.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add memory cache for GitHub API responses</name>
  <files>components/github-activity.tsx</files>
  <action>
Implement simple memory cache with 5-minute TTL for GitHub events API.

From RESEARCH.md, use this pattern (module-level cache to persist across remounts):

```typescript
// Module-level cache (outside component)
type CacheEntry = {
  data: GitHubEvent[];
  timestamp: number;
};

const eventCache = new Map<string, CacheEntry>();
const CACHE_TTL = 5 * 60 * 1000; // 5 minutes

function getCachedEvents(username: string): GitHubEvent[] | null {
  const cacheKey = `github_events_${username}`;
  const cached = eventCache.get(cacheKey);

  if (!cached) return null;
  if (Date.now() - cached.timestamp > CACHE_TTL) {
    eventCache.delete(cacheKey);
    return null;
  }

  return cached.data;
}

function setCachedEvents(username: string, events: GitHubEvent[]): void {
  const cacheKey = `github_events_${username}`;
  eventCache.set(cacheKey, {
    data: events,
    timestamp: Date.now(),
  });
}
```

Update the useEffect fetch logic:

```typescript
useEffect(() => {
  async function fetchGitHubActivity() {
    // Check cache first
    const cached = getCachedEvents(username);
    if (cached) {
      setEvents(cached);
      setLoading(false);
      return;
    }

    // Fetch from API
    try {
      const response = await fetch(
        `https://api.github.com/users/${username}/events/public?per_page=5`,
      );
      if (!response.ok) throw new Error("Failed to fetch");
      const data = await response.json();

      // Cache the response
      setCachedEvents(username, data);
      setEvents(data);
    } catch {
      setError("Unable to load activity");
    } finally {
      setLoading(false);
    }
  }
  fetchGitHubActivity();
}, [username]);
```

Why memory cache instead of localStorage:

- Simpler implementation (no JSON parse/stringify)
- Clears on page refresh (acceptable for portfolio)
- No storage quota concerns
- Aligns with RESEARCH.md recommendation for simple use case
  </action>
  <verify>

1. Build passes: `npm run build`
2. Cache constants exist: `grep -n "CACHE_TTL" components/github-activity.tsx`
3. Cache functions exist: `grep -n "getCachedEvents\|setCachedEvents" components/github-activity.tsx`
4. Cache used in fetch: `grep -n "getCachedEvents" components/github-activity.tsx`
   </verify>
   <done>GitHub API responses cached in memory with 5-minute TTL, cache hit returns data without API call</done>
   </task>

</tasks>

<verification>
After completing all tasks:
1. Build passes: `npm run build`
2. No TypeScript errors: `npx tsc --noEmit`
3. Cache implementation present: `grep -c "eventCache" components/github-activity.tsx` returns > 0
4. TTL defined: `grep "CACHE_TTL" components/github-activity.tsx`
5. Manual test: Open Network tab, load site twice within 5 min - second load should not show GitHub API call
</verification>

<success_criteria>

- [ ] Memory cache with 5-minute TTL implemented
- [ ] getCachedEvents checks timestamp and returns null on expiry
- [ ] setCachedEvents stores events with timestamp
- [ ] useEffect checks cache before fetching
- [ ] Build passes without errors
      </success_criteria>

<output>
After completion, create `.planning/phases/08-technical-debt/08-02-SUMMARY.md`
</output>
