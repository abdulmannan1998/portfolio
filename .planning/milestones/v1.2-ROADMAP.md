# Milestone v1.2: SSR Migration

**Status:** ✅ SHIPPED 2026-02-07
**Phases:** 9-12
**Total Plans:** 10

## Overview

Restructure the portfolio from a fully client-rendered app to a server-first architecture, leveraging server components, ISR, client boundary extraction, and Partial Prerendering. Keep framer-motion for animations inside properly isolated client boundaries.

**Strategy pivot:** Phases 9-10 (CSS animation replacement) were reverted after UAT revealed animation-timeline: view() doesn't work reliably. New approach: keep framer-motion, wrap animated sections in client boundary components, and achieve SSR benefits through component architecture rather than animation replacement.

## Phases

### Phase 9: Server-side GitHub Fetching

**Goal**: GitHub activity data loads instantly on page render with no client-side fetch or loading flash, refreshed via ISR
**Depends on**: v1.1 complete
**Requirements**: DATA-01, DATA-02, DATA-03, DATA-04
**Plans**: 1 plan

Plans:

- [x] 09-01-PLAN.md -- Extract server-side GitHub fetch with ISR, refactor GitHubActivity to presentational

**Details:**

- Created lib/github.ts with fetchGitHubCommits() and ISR (5-min revalidation)
- Split page.tsx into server wrapper + client PageContent
- Simplified API route from 193 → 16 lines (92% reduction)
- Made GitHubActivity purely presentational (props-based, no fetch logic)

### Phase 10: Client Boundary Extraction

**Goal**: Animated sections and interactive components live in "use client" wrapper files that receive server-rendered data as props/children, enabling page.tsx to become a server component while preserving all framer-motion animations
**Depends on**: Phase 9
**Requirements**: RSC-02, RSC-03, RSC-04, RSC-05, CBH-01, CBH-02
**Plans**: 5 plans

Plans:

- [x] 10-01-PLAN.md -- Convert twinkling-stars, css-preloader, and graph-legend to server components
- [x] 10-02-PLAN.md -- Convert marquee-text to CSS animation and add Intersection Observer to animated-counter
- [x] 10-03-PLAN.md -- UAT gap closure: remove dead code, revert marquee to framer-motion
- [x] 10-04-PLAN.md -- Extract Hero and About sections into "use client" wrapper components
- [x] 10-05-PLAN.md -- Refactor section components to accept data as props instead of importing internally

**Details:**

- Converted twinkling-stars, css-preloader, graph-legend to server components
- Added Intersection Observer to AnimatedCounter for visibility-triggered animation
- Reverted marquee to framer-motion (honors strategy pivot after UAT)
- Extracted Hero and About sections into dedicated wrapper components
- All section wrappers accept data via props (no internal imports)

### Phase 11: Server Component Page

**Goal**: page.tsx is a server component with "use client" removed, and all client-side code lives inside properly isolated boundary files
**Depends on**: Phase 9, Phase 10
**Requirements**: RSC-01, CBH-03
**Plans**: 1 plan

Plans:

- [x] 11-01-PLAN.md -- Dissolve page-content.tsx into server component page.tsx, internalize hero scroll parallax

**Details:**

- page.tsx converted to async server component directly composing all sections
- HeroSection internalized scroll parallax with section-aware tracking
- page-content.tsx fully dissolved
- Created graph-section-loader.tsx client wrapper for Next.js 16 Turbopack constraint

### Phase 12: PPR & Image Optimization

**Goal**: The portfolio uses Partial Prerendering to serve a static shell instantly while streaming dynamic content, and all images use next/image optimization
**Depends on**: Phase 11
**Requirements**: PPR-01, PPR-02, PPR-03, PPR-04, IMG-01, IMG-02
**Plans**: 3 plans

Plans:

- [x] 12-01-PLAN.md -- Add Suspense streaming and ErrorBoundary for GitHub activity, split TechAndCodeSection for PPR static shell
- [x] 12-02-PLAN.md -- Replace raw img tags with next/image for tech stack icons
- [x] 12-03-PLAN.md -- Fix PPR static shell visibility (framer-motion initial opacity: 0 gap closure)

**Details:**

- Split TechAndCodeSection into TechStackSection (static) and GitHubActivityStream (dynamic) for PPR boundary
- Page function made synchronous (async fetching in stream component)
- All 27 tech stack SVG icons migrated to next/image with unoptimized prop
- Created useHydrated hook for hydration detection across all animated sections
- PPR static shell renders visibly before JS loads (no inline opacity: 0)

---

## Milestone Summary

**Key Decisions:**

- Fetch-level ISR instead of segment-level revalidate (cacheComponents conflict)
- Server/client page split for SSR data + client interactivity
- Keep framer-motion (CSS animation-timeline: view() unreliable — strategy pivot)
- Client boundary wrappers for SSR benefits via component architecture
- PPR split: static shell + dynamic streaming
- useHydrated hook as standard hydration detection utility
- Conditional initial + key remount for PPR shell visibility
- next/image with unoptimized prop for SVG icons
- graph-section-loader.tsx client wrapper for Next.js 16 Turbopack constraint

**Issues Resolved:**

- cacheComponents conflict with segment-level revalidate (used fetch-level ISR)
- CSS animation-timeline: view() unreliable (reverted to framer-motion with client boundaries)
- Next.js 16 Turbopack: dynamic() with ssr:false not allowed in server components (client wrapper)
- framer-motion initial opacity: 0 breaking PPR static shell (hydration-aware pattern)
- framer-motion keyframe animations skipped during hydration (conditional render approach)

**Issues Deferred:**

- Remove framer-motion entirely (still needed for hero parallax, graph interactions)
- On-demand ISR via webhook (fetch-level revalidation sufficient for now)
- Advanced image optimization (blur placeholders, responsive srcset)

**Technical Debt Incurred:**

- None significant — architecture is clean and extensible

---

_For current project status, see .planning/MILESTONES.md_
